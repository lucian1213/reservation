<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2월 예약 시스템</title>
    <!-- Firebase SDK 추가 -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    
    <style>
        /* 이전 CSS 스타일 전체 복사 */
        /* (이전 코드의 style 태그 내용을 그대로 유지) */
    </style>
</head>
<body>
    <!-- 이전 HTML 구조 유지 -->
    
    <script>
        // Firebase 초기화
        const firebaseConfig = {
            // 이 부분은 Firebase 콘솔에서 복사해서 붙여넣을 예정
            apiKey: "여기에-api-key-입력",
            authDomain: "프로젝트ID.firebaseapp.com",
            projectId: "프로젝트ID",
            storageBucket: "프로젝트ID.appspot.com",
            messagingSenderId: "메시징ID",
            appId: "앱ID"
        };

        // Firebase 초기화
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 이전 코드의 변수들
        let selectedDate = null;
        let selectedTime = null;
        const reservations = {};

        // 예약 데이터 저장하기
        async function makeReservation() {
            const name = document.getElementById('nameInput').value;
            const phone = document.getElementById('phoneInput').value;

            if (!name || !phone) {
                alert('모든 정보를 입력해주세요.');
                return;
            }

            const dateKey = `2024-02-${selectedDate}`;
            
            try {
                // Firestore에 데이터 저장
                await db.collection('reservations').add({
                    date: dateKey,
                    time: selectedTime,
                    name: name,
                    phone: phone,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                // 로컬 상태 업데이트
                if (!reservations[dateKey]) {
                    reservations[dateKey] = {};
                }
                reservations[dateKey][selectedTime] = { name, phone };

                closeModal();
                showTimeSlots();
                updateReservationsList();
                alert('예약이 완료되었습니다!');
            } catch (error) {
                alert('예약 중 오류가 발생했습니다. 다시 시도해주세요.');
                console.error('Error:', error);
            }
        }

        // 예약 데이터 불러오기
        async function loadReservations() {
            try {
                const snapshot = await db.collection('reservations').get();
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    if (!reservations[data.date]) {
                        reservations[data.date] = {};
                    }
                    reservations[data.date][data.time] = {
                        name: data.name,
                        phone: data.phone
                    };
                });
                updateReservationsList();
            } catch (error) {
                console.error('Error loading reservations:', error);
            }
        }

        // 페이지 로드 시 예약 데이터 불러오기
        window.onload = function() {
            generateCalendar();
            loadReservations();
        }

        // 나머지 함수들은 이전 코드와 동일
        // (이전 코드의 나머지 함수들을 그대로 유지)
    </script>
</body>
</html>

import React, { useState } from 'react';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { AlertDialog, AlertDialogContent, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from '@/components/ui/alert-dialog';

const FebruaryReservation = () => {
  const [selectedDate, setSelectedDate] = useState(null);
  const [selectedTime, setSelectedTime] = useState(null);
  const [name, setName] = useState('');
  const [phone, setPhone] = useState('');
  const [reservations, setReservations] = useState({});

  // 2월 달력 데이터 생성
  const generateFebruaryDays = () => {
    const days = [];
    const firstDay = new Date(2024, 1, 1).getDay(); // 2월 1일의 요일
    
    // 빈 칸 추가
    for (let i = 0; i < firstDay; i++) {
      days.push(null);
    }
    
    // 2월 날짜 추가
    for (let i = 1; i <= 29; i++) { // 2024년은 윤년
      days.push(i);
    }
    
    return days;
  };

  // 시간대 생성 (10:00 ~ 20:00, 1시간 간격)
  const timeSlots = Array.from({ length: 11 }, (_, i) => {
    const hour = i + 10;
    return `${hour.toString().padStart(2, '0')}:00`;
  });

  // 예약 처리
  const handleReservation = () => {
    if (!selectedDate || !selectedTime || !name || !phone) return;

    const dateKey = `2024-02-${selectedDate}`;
    const newReservations = {
      ...reservations,
      [dateKey]: {
        ...(reservations[dateKey] || {}),
        [selectedTime]: { name, phone }
      }
    };

    setReservations(newReservations);
    setSelectedTime(null);
    setName('');
    setPhone('');
  };

  // 날짜별 예약 가능 여부 확인
  const isTimeSlotAvailable = (time) => {
    const dateKey = `2024-02-${selectedDate}`;
    return !reservations[dateKey]?.[time];
  };

  return (
    <div className="max-w-4xl mx-auto p-4">
      <Card className="mb-6">
        <CardHeader>
          <CardTitle>2024년 2월 예약</CardTitle>
        </CardHeader>
        <CardContent>
          {/* 달력 */}
          <div className="grid grid-cols-7 gap-2 mb-6">
            {['일', '월', '화', '수', '목', '금', '토'].map(day => (
              <div key={day} className="text-center font-bold py-2">{day}</div>
            ))}
            {generateFebruaryDays().map((day, index) => (
              <div key={index} className="aspect-square">
                {day && (
                  <Button
                    variant={selectedDate === day ? "default" : "outline"}
                    className="w-full h-full"
                    onClick={() => setSelectedDate(day)}
                  >
                    {day}
                  </Button>
                )}
              </div>
            ))}
          </div>

          {/* 시간대 선택 */}
          {selectedDate && (
            <div className="mt-6">
              <h3 className="text-lg font-semibold mb-4">2월 {selectedDate}일 예약 가능 시간</h3>
              <div className="grid grid-cols-4 gap-2">
                {timeSlots.map(time => (
                  <AlertDialog key={time}>
                    <AlertDialogTrigger asChild>
                      <Button
                        variant={selectedTime === time ? "default" : "outline"}
                        className="w-full"
                        disabled={!isTimeSlotAvailable(time)}
                      >
                        {time}
                        {!isTimeSlotAvailable(time) && " (예약됨)"}
                      </Button>
                    </AlertDialogTrigger>
                    <AlertDialogContent>
                      <AlertDialogHeader>
                        <AlertDialogTitle>
                          2월 {selectedDate}일 {time} 예약
                        </AlertDialogTitle>
                      </AlertDialogHeader>
                      <div className="space-y-4 mt-4">
                        <div>
                          <Label htmlFor="name">예약자 성함</Label>
                          <Input
                            id="name"
                            value={name}
                            onChange={(e) => setName(e.target.value)}
                            placeholder="홍길동"
                          />
                        </div>
                        <div>
                          <Label htmlFor="phone">연락처</Label>
                          <Input
                            id="phone"
                            value={phone}
                            onChange={(e) => setPhone(e.target.value)}
                            placeholder="010-0000-0000"
                          />
                        </div>
                        <Button 
                          className="w-full"
                          onClick={() => {
                            setSelectedTime(time);
                            handleReservation();
                          }}
                        >
                          예약하기
                        </Button>
                      </div>
                    </AlertDialogContent>
                  </AlertDialog>
                ))}
              </div>
            </div>
          )}
        </CardContent>
      </Card>

      {/* 예약 현황 */}
      <Card>
        <CardHeader>
          <CardTitle>예약 현황</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            {Object.entries(reservations).map(([date, timeSlots]) => (
              Object.entries(timeSlots).map(([time, details]) => (
                <div key={`${date}-${time}`} className="p-4 border rounded-lg">
                  <div className="font-medium">
                    {date.split('-')[2]}일 {time}
                  </div>
                  <div className="text-sm text-gray-500">
                    예약자: {details.name}
                  </div>
                  <div className="text-sm text-gray-500">
                    연락처: {details.phone}
                  </div>
                </div>
              ))
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  );
};

export default FebruaryReservation;
